<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <base target="_top">
  <title>Учёт для Эли</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">

  <style>
    /* Цветовая палитра */
    :root {
      --bg: #fff5f8;
      --fg: #333;
      --primary: #ffdbe6;
      --primary-hover: #ffe9f0;
      --card-bg: #fff0f5;
      --shadow: rgba(0,0,0,0.05);
      --radius: 12px;
    }
    /* Устанавливаем базовый размер шрифта через html */
    html {
      font-size: 1.7rem;
    }
    select {
      background-color: #fff;
      color: inherit;
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
    }
    /* Базовые стили */
    body {
      margin: 0;
      font-family: 'Montserrat', sans-serif;
      background: var(--bg);
      color: var(--fg);
      padding: 20px;
      font-size: 1.7rem;
    }
    h1 {
      text-align: center;
      color: #e06a91;
      font-size: 3rem;
      margin: 16px 0 50px 0;
    }

    /* Вкладки */
    .tabs {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 25px;
    } 
    .tabs button {
      background: var(--card-bg);
      border: none;
      padding: 20px 20px;
      border-radius: 25px;
      cursor: pointer;
      transition: background .3s, transform .1s;
      color: var(--fg);
      box-shadow: 0 1px 3px var(--shadow);
      font-size: 1.4rem; /* увеличенный размер шрифта */
      font-family: 'Montserrat', sans-serif;
    }
    .tabs button.active {
      background: var(--primary);
      color: #fff;
    }
    .tabs button:hover {
      background: var(--primary-hover);
    }
    .tabs button:active {
      transform: scale(0.97);
    }

    /* Панели */
    .panel {
      display: none;
      background: var(--card-bg);
      border-radius: 12px;
      padding: 3%;
      box-shadow: 0 2px 4px var(--shadow);
      max-width: none; /* растягиваем на всю ширину */
      margin: 0 auto 20px;
    }
    .panel.active {
      display: block;

    }

    /* Формы */
    form {
      display: grid;
      gap: 30px;
      width: 96%; /* растягиваем формы */
      max-width: none;
      margin: 0 auto;
    }
    input, select {
      padding: 40px;
      border: 1px solid var(--primary);
      border-radius: 40px;
      font-size: 1.6rem; /* увеличенный размер шрифта */
      transition: border-color .3s, box-shadow .3s;
      font-family: 'Montserrat', sans-serif;
    }
    input:focus, select:focus {
      border-color: var(--primary-hover);
      box-shadow: 0 0 5px var(--shadow);
      outline: none;
    }
    button[type="submit"] {
      background: var(--primary);
      color: #fff;
      border: none;
      padding: 50px;
      border-radius: 40px;
      font-size: 1.7rem; /* увеличенный размер шрифта */
      cursor: pointer;
      transition: background .3s, transform .1s, box-shadow .3s;
      box-shadow: 0 1px 3px var(--shadow);
      font-family: 'Montserrat', sans-serif;
      font-weight: 500;
    }
    button[type="submit"]:hover {
      background: var(--primary-hover);
    }
    button[type="submit"]:active {
      transform: scale(0.97);
      box-shadow: 0 1px 2px var(--shadow);
    }

    /* Сообщения */
    #msgIncome, #msgExpense {
      text-align: center;
      margin-top: 12px;
      font-weight: bold;
    }
    #msgIncome { color: #4caf50; }
    #msgExpense { color: #f44336; }

    /* Результаты прибыли */
    .result {
      display: flex;
      flex-wrap: wrap;
      margin-top: 30px;
      gap: 30px
    }
    .result .card {
      background: #fff;
      border-radius: 30px;
      padding: 12px;
      box-shadow: 0 1px 3px var(--shadow);
      flex: 1;
      margin: 0 6px;
      text-align: center;
    }
    .result .card h3 {
      margin: 0;
      font-size: 1.7rem;
      color: var(--primary);
    }
    .result .card p {
      margin: 8px 0 0;
      font-size: 1.7rem;
      font-weight: bold;
    }
    /* Первые две карточки по половине */
    .result .card {
      flex: 1 1 calc(50% - 6px); /* две в ряд, учтён gap */
    }

    /* Третья — на всю ширину */
    .result .card:nth-child(3) {
      flex: 1 1 100%;
    }
    /* История */
    #historyContent table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0 8px;
      margin-top: 30px;
    }
    #historyContent th {
      text-align: left;
      padding: 8px 12px;
      font-weight: bold;
    }
    #historyContent td {
      background: #fff;
      padding: 10px 12px;
      border-radius: var(--radius);
    }
    /* Адаптивность для мобильных */
  @media (max-width: 600px) {
    .tabs { flex-direction: column; align-items: stretch; margin: 0 10px; }
    .tabs button { width: 100%; }
    .panel { margin: 0 10px 20px; padding: 12px; max-width: none; }
    form { width: 100%; max-width: none; }
    input, select, button[type="submit"] { width: 100%; box-sizing: border-box; }
    .result { flex-direction: column; gap: 12px; }
    .result .card { margin: 6px 0; }
    #historyContent table, #historyContent th, #historyContent td { font-size: 0.85rem; }
    /* облегчённый фон карточки на мобайле */
    body { padding: 10px; }
    h1 { font-size: 1.5rem; }

    .nav-icons {
    display: flex;
    justify-content: center;
    gap: 24px;
    margin-bottom: 16px;
  }
  .icon-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 48px;
    height: 48px;
    background: var(--card-bg);
    border-radius: var(--radius);
    box-shadow: 0 2px 4px var(--shadow);
    transition: background .2s, transform .1s;
  }
  .icon-btn:hover {
    background: var(--primary-hover);
    transform: scale(1.05);
  }
  .icon-btn:active {
    transform: scale(0.95);
  }
  .icon-btn svg {
    width: 1.5em;
    height: 1.5em;
  }
}

</style>
</head>
<body>
  <!-- Навигационные иконки -->
  <div class="nav-icons">
    <!-- Плюс → очередь заказов -->
    <a href="?page=orders" class="icon-btn" title="Новый заказ">
      <!-- простая SVG-иконка плюса -->
      <svg width="32" height="32" viewBox="0 0 24 24" fill="var(--primary)" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
    </a>
    <!-- Корзина → склад -->
    <a href="?page=stock" class="icon-btn" title="Склад">
      <!-- SVG-иконка корзины -->
      <svg width="32" height="32" viewBox="0 0 24 24" fill="var(--primary)" xmlns="http://www.w3.org/2000/svg">
        <path d="M6 6h15l-1.5 9h-13L6 6zM6 6l-2-4H1" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
        <circle cx="9" cy="22" r="2" fill="currentColor"/>
        <circle cx="17" cy="22" r="2" fill="currentColor"/>
      </svg>
    </a>
  </div>
  <h1>Учёт для Эли</h1>

  <div class="tabs">
    <button data-tab="income"  class="active">Доходы</button>
    <button data-tab="expense">Расходы</button>
    <button data-tab="profit">Прибыль</button>
    <button data-tab="history">История</button>
  </div>

  <!-- Панель ДОХОДЫ -->
  <div id="income" class="panel active">
    <form id="incomeForm">
      <input name="clientName" placeholder="Имя клиента" required>
      <input name="product"    placeholder="Товар"       required>
      <input name="quantity"   type="number" placeholder="Количество" required>
      <input name="sum"        type="number" placeholder="Сумма"      required>
      <select name="paymentMethod" required>
        <option value="">— Способ оплаты —</option>
        <option value="Наличка">Наличка</option>
        <option value="Каспи">Каспи</option>
      </select>
      <button type="submit">Сохранить доход</button>
    </form>
    <div id="msgIncome"></div>
  </div>

  <!-- Панель РАСХОДЫ -->
  <div id="expense" class="panel">
    <form id="expenseForm">
      <select name="category" required>
        <option value="">— Категория —</option>
        <option value="Кондитерка">Кондитерка</option>
        <option value="Продукты">Продукты</option>
        <option value="Упаковка">Упаковка</option>
        <option value="Курьер">Курьер</option>
        <option value="Ягоды">Ягоды</option>
        <option value="Реклама">Реклама</option>
        <option value="Аренда">Аренда</option>
        <option value="Ком. услуги">Ком. услуги</option>
        <option value="Налоги">Налоги</option>
      </select>
      <input name="sum"  type="number" placeholder="Сумма" required>
      <input name="note" placeholder="Примечание">
      <button type="submit">Сохранить расход</button>
    </form>
    <div id="msgExpense"></div>
  </div>

  <!-- Панель ПРИБЫЛЬ -->
  <div id="profit" class="panel">
    <form id="profitForm">
      <label>
        Период (дней):
        <input name="days" type="number" min="1" value="7" required style="margin-top: 30px;">
      </label>
      <button type="submit">Рассчитать</button>
    </form>
    <div class="result">
      <div class="card">
        <h3>Доход</h3>
        <p id="rIncome">—</p>
      </div>
      <div class="card">
        <h3>Расход</h3>
        <p id="rExpense">—</p>
      </div>
      <div class="card">
        <h3>Прибыль</h3>
        <p id="rProfit">—</p>
      </div>
    </div>
  </div>

  <!-- Панель ИСТОРИЯ -->
  <div id="history" class="panel">
    <form id="historyForm">
      <label>
        Показывать записей:
        <input name="count" type="number" min="1" value="10" required style="margin-top: 30px;">
      </label>
      <button type="submit">Загрузить</button>
    </form>
    <div id="historyContent" style="overflow:auto; margin-top:12px;"></div>
  </div>

  <script>
    // Переключение табов
    document.querySelectorAll('.tabs button').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.tabs button').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById(btn.dataset.tab).classList.add('active');
      });
    });

    // ДОХОДЫ
    document.getElementById('incomeForm').addEventListener('submit', e => {
      e.preventDefault();
      const data = Object.fromEntries(new FormData(e.target));
      const msg = document.getElementById('msgIncome');
      msg.textContent = 'Отправка…';
      google.script.run.withSuccessHandler(res => {
        msg.textContent = res === 'OK' ? '✅ Доход сохранён' : '❌ ' + res;
        if (res === 'OK') e.target.reset();
      }).saveIncome(data);
    });

    // РАСХОДЫ
    document.getElementById('expenseForm').addEventListener('submit', e => {
      e.preventDefault();
      const data = Object.fromEntries(new FormData(e.target));
      const msg = document.getElementById('msgExpense');
      msg.textContent = 'Отправка…';
      google.script.run.withSuccessHandler(res => {
        msg.textContent = res === 'OK' ? '✅ Расход сохранён' : '❌ ' + res;
        if (res === 'OK') e.target.reset();
      }).saveExpense(data);
    });

    // ПРИБЫЛЬ
    document.getElementById('profitForm').addEventListener('submit', e => {
      e.preventDefault();
      const days = parseInt(e.target.days.value, 10);
      const incEl = document.getElementById('rIncome');
      const expEl = document.getElementById('rExpense');
      const profEl= document.getElementById('rProfit');
      incEl.textContent = '…'; expEl.textContent = '…'; profEl.textContent = '…';
      google.script.run.withSuccessHandler(obj => {
        incEl.textContent  = obj.income;
        expEl.textContent  = obj.expense;
        profEl.textContent = obj.profit;
      }).computeProfit(days);
    });

    // ИСТОРИЯ
    document.getElementById('historyForm').addEventListener('submit', e => {
      e.preventDefault();
      const cnt = parseInt(e.target.count.value, 10);
      const container = document.getElementById('historyContent');
      container.innerHTML = 'Загрузка…';
      google.script.run.withSuccessHandler(html => {
        container.innerHTML = html;
      }).getHistory(cnt);
    });
  </script>

</body>
</html>
